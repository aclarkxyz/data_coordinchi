<!DOCTYPE html>
<html>

<head>
	<title>Coordination InChI Demo</title>

	<link href="img/icon.png" rel="icon" type="image/png">
	<link href="main.css" rel="stylesheet" type="text/css">
	<script src="jquery.js" type="text/javascript"></script>
	<script src="coordinchi.js" type="text/javascript"></script>
</head>

<body style="padding: 0.5em;">
	<span id="moldata" style="display: none;">
		<span>SketchEl!(5,4)
Pt=0.0000,0.0000;0,0,i0
N=-1.5718,0.9075;0,0,i3
Cl=1.5718,-0.9075;0,0,i0
Cl=1.5718,0.9075;0,0,i0
N=-1.5718,-0.9075;0,0,i3
1-2=0,2
1-3=1,1
1-4=1,2
1-5=0,1
!End</span>
		<span>SketchEl!(8,8)
B=-3.9143,0.4857;0,0,i0
H=-5.2133,1.2357;0,0,i0
H=-2.6152,-0.2643;0,0,i0
H=-5.2133,-0.2643;0,0,i0
H=-2.6152,1.2357;0,0,i0
B=-1.3162,0.4857;0,0,i0
H=-0.0172,-0.2643;0,0,i0
H=-0.0172,1.2357;0,0,i0
1-2=1,0
1-3=0,0
1-4=1,0
1-5=1,0
3-6=1,0
5-6=0,0
6-7=1,0
6-8=1,0
!End</span>
		<span>SketchEl!(17,18)
Ni=0.0000,0.0000;0,0,i0
O=-1.1499,1.2990;0,0,i0
C=-2.6499,1.2991;0,0,i0
C=-3.4000,0.0003;0,0,i1
C=-2.6501,-1.2990;0,0,i0
O=-1.1501,-1.2991;0,0,i0
C=-3.4003,-2.5979;0,0,i3
C=-3.3997,2.5983;0,0,i3
O=1.1499,-1.2991;0,0,i0
C=2.6499,-1.2991;0,0,i0
C=3.4000,-0.0003;0,0,i1
C=2.6501,1.2990;0,0,i0
O=1.1501,1.2990;0,0,i0
C=3.4003,2.5979;0,0,i3
C=3.3997,-2.5983;0,0,i3
O=0.0001,2.4158;0,0,i2
O=-0.0001,-2.4158;0,0,i2
2-3=2,0
1-2=0,2
3-4=1,0
4-5=2,0
5-6=1,0
1-6=1,1
5-7=1,0
3-8=1,0
9-10=2,0
1-9=0,1
10-11=1,0
11-12=2,0
12-13=1,0
1-13=1,2
12-14=1,0
10-15=1,0
1-16=0,0
1-17=0,0
!End</span>
		<span>SketchEl!(16,26)
Ge=7.9278,0.0827;0,0,i0
Fe=2.2441,-0.0912;0,0,i0,xARENE:2:1,xARENE:1:1
Cl=9.9207,1.4541;0,0,i0
Cl=10.1120,-0.9572;0,0,i0
S=6.7678,2.1707;0,0,i0
S=6.9998,-2.4692;0,0,i0
C=4.4136,2.1608;0,0,i0,xARENE:1:2
C=4.3555,-2.4791;0,0,i0,xARENE:2:2
C=3.6070,1.5826;0,0,i1,xARENE:1:3
C=2.2441,2.9726;0,0,i1,xARENE:1:6
C=3.4911,-3.3952;0,0,i1,xARENE:2:3
C=2.3021,-1.7832;0,0,i1,xARENE:2:6
C=0.9970,1.5826;0,0,i1,xARENE:1:4
C=0.1907,2.1608;0,0,i1,xARENE:1:5
C=0.8812,-3.3952;0,0,i1,xARENE:2:4
C=0.1327,-2.4791;0,0,i1,xARENE:2:5
1-3=1,2
1-4=1,1
5-7=1,0
6-8=1,0
7-9=1,0
7-10=1,0
8-11=1,0
8-12=1,0
9-13=2,0
10-14=2,0
11-15=2,0
12-16=2,0
13-14=1,0
15-16=1,0
1-5=1,0
1-6=1,0
2-10=0,0
2-11=0,0
2-12=0,0
2-13=0,0
2-14=0,0
2-15=0,0
2-16=0,0
2-7=1,0
2-8=1,0
2-9=0,0
!End</span>
		<span>SketchEl!(21,25)
Fe=0.0000,0.0000;0,0,i0
O=-0.0000,3.8906;0,0,i0
O=0.0000,-3.8906;0,0,i0
N=-1.6990,1.2079;0,0,i0
O=1.7990,-0.9075;0,0,i1
O=1.7990,0.9075;0,0,i1
N=-1.6990,-1.2079;0,0,i0
C=0.7500,2.2500;0,0,i0
C=-0.7500,2.2500;0,0,i2
C=-0.7500,-2.2500;0,0,i2
C=0.7500,-2.2500;0,0,i0
C=-3.1990,0.7500;0,0,i2
C=-3.1990,-0.7500;0,0,i2
O=1.6092,3.4795;0,0,i0
O=1.6093,-3.4795;0,0,i0
C=-1.7490,3.5867;0,0,i0
C=-2.4223,2.6627;0,0,i2
C=-2.4223,-2.6627;0,0,i2
C=-1.7490,-3.5867;0,0,i0
O=-2.7096,4.7388;0,0,i0
O=-2.6635,-4.7757;0,0,i0
1-2=1,0
1-3=1,0
1-4=0,2
1-5=0,1
1-6=0,2
1-7=0,1
6-8=1,0
8-9=1,0
9-4=1,0
7-10=1,0
10-11=1,0
11-5=1,0
4-12=1,0
12-13=1,0
13-7=1,0
8-14=2,0
11-15=2,0
2-16=1,0
16-17=1,0
17-4=1,0
7-18=1,0
18-19=1,0
19-3=1,0
16-20=2,0
19-21=2,0
!End</span>
		<span>SketchEl!(20,24)
Te=-6.8081,4.6658;0,0,i0
Cl=-6.8081,-0.0419;0,0,i0
Te=-2.1005,-0.0419;0,0,i0
Cl=-2.1005,4.6658;0,0,i0
Cl=-4.3005,6.3919;0,0,i0
Te=0.4071,6.3919;0,0,i0
Cl=0.4071,1.6842;0,0,i0
Te=-4.3005,1.6842;0,0,i0
Cl=0.4408,8.3881;0,0,i0
Cl=2.4036,6.3919;0,0,i0
Cl=-6.7898,6.6622;0,0,i0
Cl=-8.8046,4.6658;0,0,i0
Cl=-2.1005,-2.0384;0,0,i0
Cl=-6.2970,1.6842;0,0,i0
Cl=-4.3106,0.1546;0,0,i0
Cl=-2.6559,2.8162;0,0,i0
Cl=-8.4535,3.5349;0,0,i0
Cl=2.0517,7.5239;0,0,i0
Cl=-3.7458,-1.1727;0,0,i0
Cl=-0.1040,-0.0419;0,0,i0
1-2=0,0
2-3=0,0
3-4=0,0
1-4=0,0
1-5=1,2
6-4=1,1
3-7=1,2
8-2=1,1
8-5=0,0
5-6=0,0
6-7=0,0
7-8=0,0
6-9=1,0
6-10=1,0
1-11=1,0
1-12=1,0
3-13=1,0
8-14=1,0
8-15=1,0
8-16=1,2
1-17=1,1
6-18=1,2
3-19=1,1
3-20=1,0
!End</span>
		<span>SketchEl!(16,15)
Co=1.7564,-0.1185;3,0,i0,z0
N=-1.0620,0.2283;0,0,i2,z0
N=0.0241,-1.2398;0,0,i2,z0
N=1.7564,2.9566;0,0,i2,z0
N=3.3604,1.0236;0,0,i2,z0
N=4.5516,-0.4469;0,0,i2,z0
N=1.7564,-3.1729;0,0,i2,z0
C=-2.9948,-0.4829;0,0,i2,z0
C=-2.1223,-1.1272;0,0,i2,z0
C=3.2840,4.3480;0,0,i2,z0
C=4.0562,2.9566;0,0,i2,z0
C=5.7688,-2.5339;0,0,i2,z0
C=4.0974,-4.1406;0,0,i2,z0
Cl=8.5404,2.4153;-1,0,i0,z0
Cl=8.5670,0.5229;-1,0,i0,z0
Cl=8.5731,-1.4040;-1,0,i0,z0
1-2=0,2
1-3=0,1
1-4=0,0
1-5=0,2
1-6=0,1
1-7=0,0
2-8=1,0
3-9=1,0
4-10=1,0
5-11=1,0
6-12=1,0
7-13=1,0
8-9=1,0
10-11=1,0
12-13=1,0
!End</span>
		<span>SketchEl!(17,20)
Sn=0.0000,0.0000;0,0,i0
H=1.9019,1.0981;0,0,i0
N=-0.0000,-2.1961;0,0,i0
H=1.9019,-1.0981;0,0,i0
N=-0.0000,2.1962;0,0,i0
C=-1.4489,-2.5844;0,0,i0
C=-1.8371,-4.0333;0,0,i1
C=-0.7765,-5.0939;0,0,i1
C=0.6724,-4.7057;0,0,i1
C=1.0607,-3.2568;0,0,i1
C=1.0607,3.2568;0,0,i1
C=0.6724,4.7057;0,0,i1
C=-0.7765,5.0939;0,0,i1
C=-1.8371,4.0333;0,0,i1
C=-1.4489,2.5844;0,0,i0
O=-2.5095,1.5237;0,0,i0
O=-2.5095,-1.5237;0,0,i0
1-2=1,2
1-3=0,0
1-4=1,1
1-5=0,0
3-6=2,0
6-7=1,0
7-8=2,0
8-9=1,0
9-10=2,0
10-3=1,0
5-11=2,0
11-12=1,0
12-13=2,0
13-14=1,0
14-15=2,0
15-5=1,0
15-16=1,0
6-17=1,0
1-16=1,2
1-17=1,1
!End</span>
		<span>SketchEl!(14,16)
C=-5.0691,3.3250;0,0,i0
O=-3.5160,1.7719;0,0,i0
Rh=-1.9631,3.3250;0,0,i0
O=-3.5160,4.8781;0,0,i0
O=-0.4103,1.7719;0,0,i0
Rh=1.1426,3.3250;0,0,i0
O=-0.4103,4.8781;0,0,i0
O=2.6957,1.7719;0,0,i0
C=4.2483,3.3250;0,0,i0
O=2.6957,4.8781;0,0,i0
C=-6.5691,3.3250;0,0,i3
C=5.7483,3.3250;0,0,i3
C=-0.4103,0.2719;0,0,i3
C=-0.4103,6.3781;0,0,i3
1-2=1,0
3-2=1,1
3-4=0,2
4-1=2,0
3-5=0,1
6-5=1,1
6-7=0,2
3-7=1,2
6-8=0,1
8-9=2,0
9-10=1,0
6-10=1,2
1-11=1,0
9-12=1,0
5-13=1,0
7-14=1,0
!End</span>
		<span>SketchEl!(28,28)
Ni=1.1000,0.0000;-1,0,i0
N=2.5606,1.4607;0,0,i0
N=-0.3117,-1.4119;0,0,i0
N=2.5607,-1.4606;0,0,i0
N=4.0606,1.4607;1,0,i0
N=5.5606,1.4607;0,0,i0
Ni=7.0213,0.0001;-1,0,i0
N=8.4331,-1.4116;0,0,i0
N=5.5607,-1.4606;0,0,i0
N=4.0607,-1.4605;1,0,i0
N=-1.3723,-2.4726;1,0,i0
N=-2.4329,-3.5333;-1,0,i0
N=9.4938,-2.4722;1,0,i0
N=10.5545,-3.5328;-1,0,i0
P=8.4330,1.4120;0,0,i0
C=7.3723,2.4726;0,0,i2
C=9.4936,2.4727;0,0,i2
C=9.4937,0.3514;0,0,i2
P=-0.3119,1.4119;0,0,i0
C=-1.3725,0.3512;0,0,i2
C=-1.3725,2.4725;0,0,i2
C=0.7488,2.4725;0,0,i2
C=10.9426,0.7397;0,0,i3
C=7.7605,3.9215;0,0,i3
C=0.3606,3.9214;0,0,i3
C=-2.8214,0.7394;0,0,i3
C=-2.8214,2.0843;0,0,i3
C=10.9425,2.0845;0,0,i3
1-2=1,2
1-3=1,1
1-4=1,1
2-5=2,0
5-6=2,0
7-6=1,2
7-8=1,1
7-9=1,1
4-10=2,0
10-9=2,0
3-11=2,0
11-12=2,0
8-13=2,0
13-14=2,0
15-16=1,0
15-17=1,0
15-18=1,0
7-15=0,2
19-20=1,0
19-21=1,0
19-22=1,0
1-19=0,2
18-23=1,0
16-24=1,0
22-25=1,0
20-26=1,0
21-27=1,0
17-28=1,0
!End</span>
		<span>SketchEl!(24,24)
Ni=1.0000,0.0000;0,0,i0
N=-0.7290,-0.9983;0,0,i3
N=2.7990,0.7500;0,0,i0
N=1.0000,-1.9965;0,0,i3
N=1.0000,1.9965;0,0,i3
N=-0.7290,0.9983;0,0,i3
N=2.7990,-0.7500;0,0,i0
C=4.0980,1.5000;0,0,i0
C=5.3970,2.2500;0,0,i1
C=4.0980,-1.5000;0,0,i0
C=5.3970,-2.2500;0,0,i1
C=5.3970,3.7500;0,0,i0
C=6.6960,1.5000;0,0,i0
N=5.3970,5.2500;0,0,i0
C=5.3970,-3.7500;0,0,i0
C=6.6960,-1.5000;0,0,i0
N=5.3970,-5.2500;0,0,i0
N=7.9950,0.7500;0,0,i0
N=7.9950,-0.7500;0,0,i0
Ni=9.7940,0.0000;0,0,i0
N=11.5230,-0.9983;0,0,i3
N=11.5230,0.9983;0,0,i3
N=9.7940,-1.9965;0,0,i3
N=9.7940,1.9965;0,0,i3
1-2=0,1
1-3=0,2
1-4=0,0
1-5=0,0
1-6=0,2
1-7=0,1
3-8=3,0
8-9=1,0
7-10=3,0
10-11=1,0
9-12=1,0
9-13=1,0
12-14=3,0
11-15=1,0
11-16=1,0
15-17=3,0
13-18=3,0
16-19=3,0
20-18=0,2
20-19=0,1
20-21=0,1
20-22=0,2
20-23=0,0
20-24=0,0
!End</span>
		<span>SketchEl!(16,17)
Mo=1.3000,0.0000;0,0,i0
O=2.8817,-1.2135;0,0,i0
C=4.3083,-0.7500;0,0,i0
C=4.3083,0.7500;0,0,i0
O=2.8817,1.2135;0,0,i0
O=5.7349,-1.2135;0,0,i0
Mo=7.3166,0.0000;0,0,i0
O=5.7349,1.2135;0,0,i0
Cl=1.3000,1.5000;0,0,i0
Cl=1.3000,-1.5000;0,0,i0
Cl=7.3166,-1.5000;0,0,i0
Cl=7.3166,1.5000;0,0,i0
O=-0.4290,0.9983;0,0,i0
O=-0.4290,-0.9983;0,0,i0
O=9.0456,-0.9983;0,0,i0
O=9.0456,0.9983;0,0,i0
1-2=1,1
2-3=1,0
3-4=1,0
4-5=2,0
1-5=0,2
3-6=2,0
7-6=0,1
7-8=1,2
8-4=1,0
1-9=1,0
1-10=1,0
7-11=1,0
7-12=1,0
1-13=2,2
1-14=2,1
7-15=2,1
7-16=2,2
!End</span>
		<span>SketchEl!(15,16)
Ni=1.5000,0.0000;0,0,i0
N=1.5000,2.6574;0,0,i0
N=1.5000,-2.6574;0,0,i0
N=2.8817,-1.2135;0,0,i2
C=4.3083,-0.7500;0,0,i2
C=4.3083,0.7500;0,0,i2
N=2.8817,1.2135;0,0,i2
N=0.1183,1.2135;0,0,i2
C=-1.3083,0.7500;0,0,i2
C=-1.3083,-0.7500;0,0,i2
N=0.1183,-1.2135;0,0,i2
C=2.7990,3.4074;0,0,i0
C=0.2010,-3.4074;0,0,i0
S=4.0980,4.1574;0,0,i0
S=-1.0980,-4.1574;0,0,i0
1-2=1,0
1-3=1,0
1-4=0,1
4-5=1,0
5-6=1,0
6-7=1,0
1-7=0,2
1-8=0,2
8-9=1,0
9-10=1,0
10-11=1,0
1-11=0,1
2-12=2,0
3-13=2,0
12-14=2,0
13-15=2,0
!End</span>
		<span>SketchEl!(11,12)
Co=0.0000,0.0000;1,0,i0
Cl=-0.0000,1.5000;0,0,i0
Cl=0.0000,-1.5000;0,0,i0
N=-1.3817,1.2135;0,0,i2
C=-2.8083,0.7500;0,0,i2
C=-2.8083,-0.7500;0,0,i2
N=-1.3817,-1.2135;0,0,i2
N=1.3817,-1.2135;0,0,i2
C=2.8083,-0.7500;0,0,i2
C=2.8083,0.7500;0,0,i2
N=1.3817,1.2135;0,0,i2
1-2=1,0
1-3=1,0
1-4=0,2
4-5=1,0
5-6=1,0
6-7=1,0
1-7=0,1
1-8=0,1
8-9=1,0
9-10=1,0
10-11=1,0
1-11=0,2
!End</span>
		<span>SketchEl!(12,12)
Mo=-1.8087,-0.3481;0,0,i0
O=-1.8087,1.8481;0,0,i0
O=-1.8087,-2.5442;0,0,i2
O=-3.7106,0.7500;0,0,i2
O=0.0933,-1.4462;0,0,i0
O=0.0933,0.7500;0,0,i0
O=-3.7106,-1.4462;0,0,i2
Mo=1.9952,-0.3481;0,0,i0
O=3.8971,-1.4461;0,0,i2
O=3.8971,0.7500;0,0,i2
O=1.9952,-2.5442;0,0,i2
O=1.9952,1.8481;0,0,i0
1-2=2,0
1-3=0,0
1-4=0,2
1-5=1,1
1-6=1,2
1-7=0,1
8-6=1,2
8-5=1,1
8-9=0,1
8-10=0,2
8-11=0,0
8-12=2,0
!End</span>

	</span>

	<h1 style="margin-top: 0;">Coordination InChI Demo</h1>

	<div style="display: flex">
		<div id="sketcher"></div>
		<div id="cases" style="display: flex; align-items: start; flex-wrap: wrap; align-content: flex-start; margin-left: 1em;"></div>
	</div>

	<div style="display: flex; margin-top: 1em; align-items: center;">
		<div id="buttons" style="margin-right: 1em; align-self: start;"></div>
		<div id="hash" style="font-family: monospace; word-break: break-all; padding: 0.2em; border: 1px solid #808080; background-color: #F0F0F0;"></div>
	</div>

	<p>
		For details about the coordination layer algorithm, see <a href="https://github.com/aclarkxyz/data_coordinchi" target="_blank">GitHub</a>.
	</p>

</body>

<script type="text/javascript">
	let wmk = WebMolKit;
	let url = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
	wmk.initWebMolKit(url + '/res');

	let molecules = [];
	$('#moldata > span').each((_, span) => molecules.push(wmk.Molecule.fromString($(span).text())));
	let mol = molecules[0];

	//var mol = wmk.Molecule.fromString($('#moldata').text());
	var sketcher = new wmk.Sketcher();
	sketcher.setSize(800, 700);
	sketcher.defineMolecule(mol);

	let proxy = new wmk.ClipboardProxyWeb();
	let handler = new wmk.ClipboardProxyHandler();
	handler.copyEvent = (andCut, proxy) =>
	{
		this.sketcher.performCopySelection(andCut);
		return true;
	};
	handler.pasteEvent = (proxy) =>
	{
		this.sketcher.pasteText(proxy.getString());
		return true;
	};
	proxy.pushHandler(handler);
	sketcher.defineClipboard(proxy);
	sketcher.defineContext(new wmk.MenuProxyWeb());

	let updateMolecule = (mol) =>
	{

		mol = mol.clone();
		wmk.MolUtil.expandAbbrevs(mol, true);
		let dots = new wmk.DotPath(mol);
		let hash = new wmk.DotHash(dots, true).calculate();
		$('#hash').text(hash);
	};
	sketcher.onChangeMolecule = updateMolecule;
	updateMolecule(mol);

	sketcher.setup(() => sketcher.render($('#sketcher')));

	let btnDots = $('<button class="wmk-button wmk-button-primary">DotPath</button>').appendTo($('#buttons'));
	btnDots.click(() => new wmk.ZoomDotMol(sketcher.getMolecule()).open());

	let policy = wmk.RenderPolicy.defaultColourOnWhite();
	policy.data.pointScale = 15;
	let casesz = 150;
	let measure = new wmk.OutlineMeasurement(0, 0, policy.data.pointScale);

	for (let casemol of molecules)
	{
		let layout = new wmk.ArrangeMolecule(casemol, measure, policy);
		layout.arrange();
		layout.squeezeInto(0, 0, casesz, casesz);
		let gfx = new wmk.MetaVector();
		new wmk.DrawMolecule(layout, gfx).draw();
		gfx.normalise();
		let div = $('<div/>').appendTo($('#cases')).css({'display': 'inline-block'});
		div.css({'padding': '0.2em', 'margin': '0 0.5em 0.5em 0', 'border': '1px solid #808080', 'background-color': '#F0F0F0', 'border-radius': '2px'});
		let span = $('<span/>').appendTo(div).css({'display': 'inline-block', 'font-size': '0'});
		$(gfx.createSVG()).appendTo(span).css('pointer-events', 'none');

		div.css({'cursor': 'pointer'});
		div.hover(() => div.css('background-color', '#C0C0C0'), () => div.css('background-color', '#F0F0F0'));
		div.click(() =>
		{
			sketcher.defineMolecule(casemol);
			sketcher.clearSubject();
			updateMolecule(casemol);
		});

	}

</script>

</html>